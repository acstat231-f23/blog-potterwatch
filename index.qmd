---
title: "Potterwatch"
author: "Sarah Fatihi and John Joire"
date: "December 13, 2023"
format:
  html:
    theme: solar
    toc: true
---

```{r}
#| label: setup
#| include: false

# Set code chunk defaults 
# Consider adding `message = FALSE` option
knitr::opts_chunk$set(echo = FALSE) 
                      
# Set R environment options
options(knitr.kable.NA = '')

# Load packages
library(tidyverse)
library(dplyr)
library(tidytext)
library(DT)
library(ggplot2)
library(knitr)

#Datasets needed for sentiment analysis
total_movie_average <- readRDS("data/bar_rated_data.rds")
sentiment_data <- readRDS("data/sentiment_data.rds")
```


# Introduction
```{r}
#| fig.cap: 
#| out.width: 80%
#| fig.align: center

knitr::include_graphics("potter-watch-logo.png")
```

It is no secret that the Harry Potter book and movie franchise is vastly beloved: its world building and character development lauded as some of the best for children and young adults. The books are split into seven installments: “Harry Potter and the Philosopher’s Stone,” “Harry Potter and the Half Blood Prince,” “Harry Potter and the Prisoner of Azkaban,” “Harry Potter and the Goblet of Fire,” “Harry Potter and the Order of the Phoenix,” “Harry Potter and the Half-Blood Prince,” and “Harry Potter and the Deathly Hallows.” The movies are divided similarly, only having two parts to “Harry Potter and the Deathly Hallows” instead of one. Seeking to see trends in character mention frequency and sentiment in the books and movies respectively, we created two visualizations.

# Sentiment Analysis

The Harry Potter series is often thought of first as a fantasy story, but under that cover, it is a rich coming-of-age story. As the movies progress, and we follow the life of a once young Harry, we also go through with him on many of his firsts. His first birthday cake, first day at Hogwarts, first friends and loves, and the quintessential first battle with a dark wizard that every average teenager goes through. The point is that the Harry Potter series is one that is full of so many emotions, which is ultimately what inspired this project. I will take you through a sentiment analysis of the many movies and discuss how using data allows you to analyze them in a way you likely haven't before.

## Chapter by Chapter Analysis

Before we begin there are a there is something really important I should explain: what exactly is a sentiment analysis? In simple terms it is the process of analyzing a text to determine the emotional tone of its message. In this case I relied on the AFINN lexicon that assigns a variety of words a score running between -5 and +5, with negative scores indicating negative sentiment and positive scores indicating positive sentiment. For each of the movies I found all words that had a matching rating in the lexicon. From there I calculated the average rating of each chapter which is displayed in the interactive graph below. You will ll see that you have the ability to select which movies you would like displayed as well as a hovering tool that allows you to look at various points on the graph and see specific details about the chapter. 

```{r}
#| label: ds-salaries-app
#| out.width: "100%"

knitr::include_app("https://sarah-fatihi.shinyapps.io/blog-potterwatch/",
                   height = "500px")
```

## Extreme Chapters
I want to bring your attention to the chapters that were noted as having the greatest and least average sentiment in the entire series. The chapter that was considered most positive is "Getting Too Close" in "Harry Potter and the Deathly Hallows Part 1". Additionally, the chapter the was considered the most negative is "Writing on the Wall" in "Harry Potter and the Chamber of Secrets". Now for those of you that are potterheads and are deeply familiar with the movies, this may already raise some red flags for you. Regardless, lets take a look at the chapters:


```{r,eval=knitr::is_html_output(excludes = "epub"), results = 'asis', echo = F}
#| fig.cap: Video
#| out.width: 80%
#| fig.align: center

cat("<p style='text-align:center;'> 'Getting Too Close' - Most Positive Chapter </p>")  #Caption

cat(
'<iframe width="560" height="315" 
  src="https://www.youtube.com/embed/LDcz02lEfi4"
  frameborder="0" allow="accelerometer; autoplay; encrypted-media;
  gyroscope; picture-in-picture" allowfullscreen>
  </iframe>'
)
```

It doesn't take an avid Harry Potter fan to sense that 'Getting Too Close' probably isn't the most positive chapter in the entire series. For those that need context: up this point the three characters you see are in hiding, and on a quest to find and destroy the remaining parts of Voldemort's (a dark wizard that is also Harry's arch-nemesis) soul in order to save the world. Voldemort is obsessed with wizard blood purity and is the leader of a movement that aims to rid the wizarding world of Muggles (non-magical humans). Under his reign, snatchers arise and their job is to capture and turn in muggle-borns, mudbloods, and blood-traitors. Coincidentally, Harry, Ron, and Hermione are all three. In the chapter you just watched despite Hermoine having set up magical barriers she is still struck by fear of getting caught and killed as a snatcher can smell her perfume. In other words, this is definitely not a positive scene. 

So if the chapter is so clearly negative, why does it show up as being the most positive scene? Well this is a very important limitation that needs to be addressed when analyzing the movies with a lexicon. In movie production there is a common principle of "show don't tell". The idea is to simply show the viewers something rather than relying on dialogue or narration to explain it. As a result the dialogue in many chapters we see are quite limited. In this case, only a few lines are considered to be in this dataset for this chapter including: "What's that?  That... smell?", "Snatchers", "Good to know your enchantments work", and "He could smell it.  My perfume." With only 4 lines of dialogue the sentiment analysis becomes extremely limited and, as it turns out, the only word that was in the lexicon was "good" with a rating of 3. It then follows that the average sentiment of the chapter is 3. 

Now that we have this limitation in mind lets take a look at the most negative chapter while paying attention to the dialogue and see why it might have that rating:

```{r,eval=knitr::is_html_output(excludes = "epub"), results = 'asis', echo = F}
#| fig.cap: Video
#| out.width: 80%
#| fig.align: center

cat("<p style='text-align:center;'> 'Writing on the Wall ' - Most Negative Chapter </p>")  #Caption

cat(
'<iframe width="560" height="315" 
  src="https://www.youtube.com/embed/bjNHWwelxN4"
  frameborder="0" allow="accelerometer; autoplay; encrypted-media;
  gyroscope; picture-in-picture" allowfullscreen>
  </iframe>'
)
```

After listening did you happen to notice any repeated words that might have negative sentiment? That's right, the word kill is used frequently and by many characters in the chapter. As it turns out, the lexicon has the word kill rated as a -3. The scene is definitely eerie which matches with its negative rating, however, it may not be the scene that comes to mind when one tries thinking of the most negative. The series is full of deaths as well as many other sad and painful moments that others would typically associate as being more negative. 

## Movie by Movie Analysis

For this reason above, I thought may also be beneficial to take a step back. The visualization below displays the average sentiment for each movie in the series. The data shown was calculated in the same way as the chapter by chapter analysis, just on a broader scale. I find that this visualization matches better with how I, and how I would think most others, picture the Harry Potter series. While this is still far from perfect there are some trends that make more sense. For one, the most negative movie is the final one in which the greatest battle of the series occurs and many beloved characters unfortunately lose their lives. Additionally, the most positive movie is "Harry Potter and the Half Blood Prince" which is the book in which Harry falls in love for the first time. This is quickly followed by the very first movie in which Harry was allowed to leave his abusive household and gets introduced to the world of magic where he finally feels belonging.

```{r}
#| label: ggplot-example
#| fig.align: left
#| out.width: 100%

#Allows for legend to be in order of movie
total_movie_average$movie <- factor(total_movie_average$movie, levels = c(
  "Harry Potter and the Philosopher's Stone",
  "Harry Potter and the Chamber of Secrets",
  "Harry Potter and the Prisoner of Azkaban",
  "Harry Potter and the Goblet of Fire",
  "Harry Potter and the Order of the Phoenix",
  "Harry Potter and the Half-Blood Prince",
  "Harry Potter and the Deathly Hallows Part 1",
  "Harry Potter and the Deathly Hallows Part 2"
))

# Plots bar graph
ggplot(total_movie_average, aes(x = movie_num, y = average_sentiment, fill = movie)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(
    values = c("#AE0001", "#2A623D", "#00165e", "#e3a000", "#808080", "black", "#9e711e", "royalblue3")
  ) +
  labs(x = "Movie Number", y = "Average Sentiment", fill = "Movies") +
  scale_x_discrete(limits = c("1", "2", "3", "4", "5", "6", "7", "8")) #sets increments to increase by 1
```

## Additional Limitations

An important limitation that also needs to be considered when analyzing a fantasy series is the scope of the lexicon. The author behind the Harry Potter books, that the movies were later based on, created a heavily fictionalized world. It's a world in which magic exists, currency is gold, and magical creatures from giants to dragons all live. With this new world, however, also comes new language. Throughout this post I've introduced some of this language including "muggles", "mud-bloods", and "snatchers" yet this is only the tip of the iceberg. There are so many other magical terms including at least 110 different spells used in the series. This language being fictional was obviously not included in the lexicon, and thus wasn't included in the analysis, but many of them have clear negative or positive connotations. A great example of this are the unforgivable curses which is best explained by this scene: 

```{r,eval=knitr::is_html_output(excludes = "epub"), results = 'asis', echo = F}
#| fig.cap: Video
#| out.width: 80%
#| fig.align: center

cat("<p style='text-align:center;'> 'The Three Unforgivable Curses' </p>")  #Caption

cat(
'<iframe width="560" height="315" 
  src="https://www.youtube.com/embed/dbV3qODiBGc"
  frameborder="0" allow="accelerometer; autoplay; encrypted-media;
  gyroscope; picture-in-picture" allowfullscreen>
  </iframe>'
)
```

## The AFINN Lexicon

While we did discuss a couple of limitations the arised from using the AFINN lexicon it is still an amazing tool for a binary analysis of the Harry Potter Series. I've created a datatable below that you can interact with to take a look into how exactly the lexicon works and how my sentiment analysis was done. It may even be interesting to review some of the earlier scenes and see if words you view as negative or positive have a rating in the lexicon. 
```{r}
# #| label: dt-example
# #| message: false
# #| echo: false
# 
# sentiment_data |>
#   DT::datatable(colnames = c("Word", "Assigned Value"),
#             filter = 'top',
#              options = list(pageLength = 10, autoWidth = TRUE))
```


# JOHN'S SECTION
```{r}
#| fig.cap: '"Safe Space" by artist Kenesha Sneed'
#| out.width: 80%
#| fig.align: center

knitr::include_graphics("characteranimation.gif")
```


# References

All data sources, any key R packages, and any other sources used in developing your blog should be cited in full in a list of references at the end of your blog. Your blog post should also link to these sources as they are discussed. You may choose any reference style as long as sources are fully cited (try to be consistent!).

Typically, references in R Markdown (and LaTeX) files are [incorporated with a BibTeX database](https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html) (a .bib file). You can try this approach or manually include either a numbered or alphabetized list. 

Columbia University has compiled some guidance on [how to cite data](https://guides.library.columbia.edu/datacitation). Some data sources will give you the citation information to copy and paste. Use the provided citations or citation styles in those cases.

You can list R package citations with the code `citation("packageName")` in the console and then copy (and reformat as needed) the relevant text, e.g.,
```{r}
citation("DT")
```

The following citations are based on the American Statistical Association citation style (not all of these references are used in this document).:


<!-- Textbook -->
Baumer, B. S., Kaplan, D. T., and Horton, N. J. (2021), *Modern Data Science with R* (2nd ed.), Boca Raton, FL: CRC Press.

<!-- Journal article -->
Broman, K. W. and Woo, K. H. (2018), "Data Organization in Spreadsheets," *The American Statistician*, 72:1, 2-10, doi: [10.1080/00031305.2017.1375989](https://doi.org/10.1080/00031305.2017.1375989)

<!-- Website -->
Columbia University Libraries (n.d.), "Data Citation," available at <https://guides.library.columbia.edu/datacitation>.

<!-- Journal article -->
McNamara, A. and Horton N. J. (2018) "Wrangling Categorical Data in R," *The American Statistician*, 72:1, 97-104, doi: [10.1080/00031305.2017.1356375](https://doi.org/10.1080/00031305.2017.1356375).

<!-- Dataset -->
Shah, Syed A. A. (October 2022), "Starbucks Drinks" (Version 1), *Kaggle*, available at <https://www.kaggle.com/datasets/syedasimalishah/starbucks-drinks>.

<!-- R package -->
Xie Y, Cheng J, Tan X (2022). "DT: A Wrapper of the JavaScript Library 'DataTables'," R package version 0.24, available at <https://CRAN.R-project.org/package=DT>.