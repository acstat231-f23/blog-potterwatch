---
title: "text-wrangling"
output: html_document
date: "2023-10-20"
---

```{r setup, include=FALSE}

# Load libraries
library(tidyverse)
library(countrycode)
library(dplyr)
library(sf)
library(wordcloud)
library(tidytext)

#CHARACTER MENTIONS

books <- read_csv("data/harry_potter_books.csv")
characters <- c("Regulus", "Sirius", "Lavender", "Cho", "Crabbe", "Crouch", 
                "Fleur", "Cedric", "Aberforth", "Dumbledore", "Dudley", "Petunia",
                "Vernon", "Filch", "Seamus", "Flamel", "Fudge", "Goyle", "Hermione", 
                "Hagrid", "Karkaroff", "Krum", "Bellatrix", "Alice", "Frank", 
                "Neville", "Luna", "Xenophilius", "Lupin", "Draco", "Lucius", 
                "Narcissa", "Maxime", "McGonagall", "Mad-Eye", "Peter", "Harry", 
                "James", "Lily", "Quirrell", "Tom", "Voldemort", "Rita", "Snape", 
                "Tonks", "Umbridge", "Arthur", "Bill", "Charlie", "Fred", "George", 
                "Ginny", "Molly", "Percy", "Ron", "Dobby", "Fluffy", "Hedwig", 
                "Myrtle", "Aragog", "Grawp")

books_all_words <- books |>
  unnest_tokens(output = word, input = text)

keywords_proportion <- books_all_words |>
  mutate(proportion = row_number() / nrow(books_all_words)) |>
  filter(word %in% characters)

#SENTIMENT LEXICON
sentiment_data <- get_sentiments("afinn")

#MOVIES
movie1 <- read_csv("data/hp1.csv")
movie2 <- read_csv("data/hp2.csv")
movie3 <- read_csv("data/hp3.csv")
movie4 <- read_csv("data/hp4.csv")
movie5 <- read_csv("data/hp5.csv")
movie6 <- read_csv("data/hp6.csv")
movie7 <- read_csv("data/hp7.csv")
movie8 <- read_csv("data/hp8.csv")

movies_list <- list(movie1, movie2, movie3, movie4, movie5, movie6, movie7, movie8)

movies <- movies_list |>
  reduce(full_join)

movies_all_words <- movies |>
  unnest_tokens(output = word, input = dialog) |>
  mutate(word = tolower(word)) |>
  select(-character)

rated_words <- movies_all_words |> 
  inner_join(sentiment_data) |>
  group_by(movie, chapter) |>
  mutate(average_sentiment = mean(value)) |>
  select(-word, -value) |>
  distinct() |>
  group_by(movie) |>
  mutate(chapt_num = row_number())
```

